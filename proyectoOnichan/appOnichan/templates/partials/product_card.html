  <article class="card-pastel h-100 d-flex flex-column product-card-hover">
    <div class="position-relative overflow-hidden rounded-top-4">
      <a href="{% url 'producto_detalle' product.id %}" class="d-block">
        <img src="{{ product.image_url }}" class="card-img-top object-fit-cover" alt="{{ product.name }}" style="aspect-ratio: 1/1; width: 100%;">
      </a>
      
      <!-- Insignias -->
      <div class="position-absolute top-0 start-0 p-3 d-flex flex-column gap-2">
        {% include 'partials/badges/stock_badge.html' with stock=product.stock %}
        {% include 'partials/badges/discount_badge.html' with discount_percentage=product.detail.discount_percentage %}
      </div>
    </div>
    <div class="card-body p-3">
      <div class="d-flex justify-content-between align-items-start mb-1">
        <h3 class="h6 product-title mb-0 text-truncate" style="max-width: 60%;">{{ product.name }}</h3>
        <div class="text-end">
          {% if product.detail.discount_percentage %}
            <div class="fw-bold text-danger">${{ product.detail.discounted_price }}</div>
            <div class="text-decoration-line-through text-muted small" style="font-size: 0.8rem;">${{ product.price }}</div>
          {% else %}
            <div class="product-price fw-bold text-primary">${{ product.price }}</div>
          {% endif %}
        </div>
      </div>
      <p class="small text-muted mb-2">{{ product.category.name|default:"General" }}</p>
      
      <div class="d-grid gap-2 mt-3">
        {% include 'partials/buttons/add_to_cart_button.html' with product=product btn_size='sm' %}
        
        {% url 'producto_detalle' product.id as product_url %}
        {% if product.stock > 0 %}
          {% include 'partials/buttons/action_button.html' with text='Ver detalles' url=product_url variant='pastel-secondary' size='sm' %}
        {% else %}
          {% include 'partials/buttons/action_button.html' with text='Ver detalles' url=product_url variant='secondary' size='sm' %}
        {% endif %}
      </div>
    </div>
  </article>
