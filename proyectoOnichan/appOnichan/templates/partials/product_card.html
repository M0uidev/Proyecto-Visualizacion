<div class="col">
  <article class="card-pastel h-100 d-flex flex-column product-card-hover">
    <div class="position-relative overflow-hidden rounded-top-4">
      <a href="{% url 'producto_detalle' product.id %}" class="d-block">
        <img src="{{ product.image_url }}" class="card-img-top object-fit-cover" alt="{{ product.name }}" style="height: 280px; width: 100%;">
      </a>
      
      <!-- Badges -->
      <div class="position-absolute top-0 start-0 p-3 d-flex flex-column gap-2">
        {% if product.stock <= 5 and product.stock > 0 %}
          <span class="badge bg-warning text-dark shadow-sm">¡Últimas unidades!</span>
        {% elif product.stock == 0 %}
          <span class="badge bg-secondary shadow-sm">Agotado</span>
        {% endif %}
        
        {% if product.detail.discount_percentage %}
          <span class="badge bg-danger shadow-sm">-{{ product.detail.discount_percentage }}%</span>
        {% endif %}
      </div>

      <!-- Quick Action Button (Optional) -->
      <button class="btn btn-light btn-sm rounded-circle position-absolute bottom-0 end-0 m-3 shadow-sm" title="Agregar a favoritos">
        <i class="bi bi-heart"></i>
      </button>
    </div>
    <div class="card-body p-3">
      <div class="d-flex justify-content-between align-items-start mb-1">
        <h3 class="h6 product-title mb-0 text-truncate" style="max-width: 60%;">{{ product.name }}</h3>
        <div class="text-end">
          {% if product.detail.discount_percentage %}
            <div class="fw-bold text-danger">${{ product.detail.discounted_price }}</div>
            <div class="text-decoration-line-through text-muted small" style="font-size: 0.8rem;">${{ product.price }}</div>
          {% else %}
            <div class="product-price fw-bold text-primary">${{ product.price }}</div>
          {% endif %}
        </div>
      </div>
      <p class="small text-muted mb-2">{{ product.category.name|default:"General" }}</p>
      
      <div class="d-grid gap-2 mt-3">
        {% if product.stock > 0 %}
        <a href="{% url 'producto_detalle' product.id %}" class="btn btn-pastel-secondary btn-sm">Ver detalles</a>
        {% else %}
        <a href="{% url 'producto_detalle' product.id %}" class="btn btn-secondary btn-sm">Ver detalles</a>
        {% endif %}
      </div>
    </div>
  </article>
</div>
