{% extends "base.html" %}

{% block title %}Panel de Trabajador{% endblock %}

{% block content %}
<div class="container" id="workerDashboard" data-worker-id="{{ worker_id }}">
  <section class="mb-4">
    <div class="row g-4 align-items-stretch">
      <div class="col-12 col-xl-5">
        <div class="card-surface p-4 h-100 d-flex flex-column justify-content-between">
          <div>
            <p class="text-uppercase small muted mb-1">Turno activo</p>
            <h1 class="h3 fw-semibold mb-1">{{ profile.name }}</h1>
            <p class="mb-2 muted">{{ profile.role }} · {{ profile.city }}</p>
          </div>
          <div class="d-flex flex-column gap-2">
            <span class="badge rounded-pill text-bg-primary align-self-start">ID {{ worker_id }}</span>
            <span class="muted">Actualizado: {{ profile.timestamp }}</span>
          </div>
        </div>
      </div>
      <div class="col-12 col-xl-7">
        <div class="card-surface h-100">
          <div class="card-header d-flex justify-content-between align-items-center">
            <span>Stats estilo JoJo's</span>
            <small class="muted">Haz clic para profundizar</small>
          </div>
          <div class="card-body">
            <div class="ratio ratio-1x1">
              <canvas id="workerStatsRadar" data-chart='{{ stats_chart|escapejs }}'></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="mb-4">
    <div class="row g-4">
      {% for stat in stats %}
      <div class="col-12 col-sm-6 col-xl-4">
        <div class="card-surface p-4 h-100">
          <p class="text-uppercase muted small mb-2">{{ stat.label }}</p>
          <div class="progress rounded-pill" style="height: 10px;">
            <div class="progress-bar" role="progressbar" style="width: {{ stat.value }}%; background: linear-gradient(90deg, #f59e0b, #8b5cf6);" aria-valuenow="{{ stat.value }}" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
          <p class="fw-semibold fs-4 mb-0 mt-3">{{ stat.value }}%</p>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>

  <section class="mb-4">
    <div class="row g-4">
      <div class="col-12 col-xl-7">
        <div class="card-surface h-100">
          <div class="card-header d-flex justify-content-between align-items-center">
            <span>Horario semanal</span>
            <small class="muted">Estado de cada turno</small>
          </div>
          <div class="table-responsive">
            <table class="table align-middle mb-0">
              <thead>
                <tr>
                  <th>Día</th>
                  <th>Turno</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>
                {% for item in schedule %}
                <tr>
                  <td class="fw-semibold">{{ item.day }}</td>
                  <td>{{ item.shift }}</td>
                  <td>
                    {% if item.status == 'Completado' %}
                    <span class="badge text-bg-success-subtle text-success">{{ item.status }}</span>
                    {% elif item.status == 'Próximo' %}
                    <span class="badge text-bg-warning-subtle text-warning">{{ item.status }}</span>
                    {% else %}
                    <span class="badge text-bg-secondary-subtle text-secondary">{{ item.status }}</span>
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="col-12 col-xl-5">
        <div class="card-surface h-100">
          <div class="card-header d-flex justify-content-between align-items-center">
            <span>Asistencia (14 días)</span>
            <small class="muted">Click para ver turno</small>
          </div>
          <div class="card-body">
            <div class="ratio ratio-16x9">
              <canvas id="workerAttendanceChart" data-chart='{{ attendance|escapejs }}'></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="mb-5">
    <div class="card-surface">
      <div class="card-header">
        <span>Notas y recordatorios</span>
      </div>
      <div class="card-body">
        <ul class="list-unstyled mb-0 d-grid gap-3">
          {% for note in notes %}
          <li class="d-flex gap-3 align-items-start">
            <span class="badge rounded-pill text-bg-info">•</span>
            <span>{{ note }}</span>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </section>

  <footer class="muted small d-flex flex-column flex-md-row justify-content-between gap-2">
    <span>Panel del colaborador · {{ profile.city }}</span>
    <span>Última sincronización: {{ profile.timestamp }}</span>
  </footer>
</div>
{% endblock %}

{% block extra_js %}
<!-- Modal genérico -->
<div class="modal fade" id="drillModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="drillTitle">Detalle</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="ratio ratio-16x9">
          <canvas id="drillChartCanvas"></canvas>
        </div>
        <div class="table-responsive mt-3">
          <table class="table table-sm" id="drillTable"></table>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="{% static 'js/worker_dashboard.js' %}"></script>
{% endblock %}
